name: Test SSH Connection
on: [push]

jobs:
  test-connection:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: SSH via Cloudflare Tunnel
        uses: appleboy/ssh-action@v1.2.4
        with:
          host: ssh.mihirniyogi.com
          username: ${{ secrets.REMOTE_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          proxy_command: |
            curl -s --header "CF-Access-Client-Id: ${{ secrets.CF_CLIENT_ID }}" --header "CF-Access-Client-Secret: ${{ secrets.CF_CLIENT_SECRET }}" https://ssh.mihirniyogi.com/cdn-cgi/access/ssh
          script: |
            echo "Successfully tunneled through Cloudflare!"
            uptime